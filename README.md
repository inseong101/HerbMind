# HerbMind (한의학 처방 보조 AI)

본 레포지토리는 한의학 처방 구성을 보조하기 위한 AI 모델 `HerbMind`의 코드입니다.
기존 한의학 교과서 처방 데이터를 기반으로, 특정 약재 조합에 추가할 다음 약재를 추천합니다.

## 프로젝트 목표
AI를 잘 모르는 한의학 연구자도 쉽게 이해할 수 있도록, AI의 추천 과정과 판단 근거(어텐션)를 시각화하는 것을 목표로 합니다.

## 실행 방법

1.  **데이터 준비**: `data/` 폴더에 5개의 한의학 교과서 처방 CSV 파일을 위치시킵니다.
    * `한국한의학연구원_한의대 간계내과학 교과서 처방 데이터_20241126.csv`
    * `한국한의학연구원_한의대 비계내과학 교과서 처방 데이터_20241126.csv`
    * (...
    * * )

2.  **사례 연구 설정**: `cases.yaml` 파일에 분석을 시작할 약재 조합(seeds)을 정의합니다. (예: `[숙지황, 山茱萸]`)

3.  **전체 실행**:
    ```bash
    bash run.sh
    ```

## 실행 결과
`run.sh` 스크립트는 다음 3단계를 순차적으로 실행합니다:

1.  `python3 train.py`: `data/` 폴더의 CSV를 읽어 AI 모델(`model_best.pth`)을 훈련합니다.
2.  `python3 test.py`: 훈련된 모델의 성능을 평가합니다.
3.  `python3 pipeline.py`: `cases.yaml`의 약재 조합을 기반으로 단계별 처방 빌드업을 수행하고, 분석 결과를 `plots/` 폴더에 저장합니다.

## 생성되는 주요 파일 (in `plots/` folder)

* **`[사례A]_table.csv`**: `[숙지황, 山茱萸]`에서 시작하여 8단계 동안 AI가 추천한 Top 3 약재 및 궁합 점수 목록표. (독자 이해를 위한 핵심 Table)
* **`[사례A]_stepN_cross_attn.png`**: (N단계) AI가 새 약재(예: `택사`)를 추가할 때, 기존 묶음(`[숙지황, 山茱萸, 산약]`)의 누구에게 주목했는지 보여주는 **바 차트**.
* **`[사례A]_stepN_self_attn.png`**: (N단계) AI가 기존 묶음(`[숙지황, 山茱萸, 산약]`)이 **서로** 얼마나 강하게 상호작용하는지 분석한 **히트맵**.

*이 코드는 [CIKM 2022에 게재된 RecipeMind 논문](https://doi.org/10.1145/3511808.3557092)의 아키텍처를 기반으로 한의학 도메인에 맞게 수정되었습니다.*
